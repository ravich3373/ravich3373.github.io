<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-05-03">

<title>Raviteja Chukkapalli - LLMs playing games</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6C8LEPK16T"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6C8LEPK16T', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Raviteja Chukkapalli</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../notes.html">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../posts.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html">
 <span class="menu-text">Random</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">Evaluation</a></li>
  <li><a href="#architectural-choices-involved-in-llm-based-agent-design" id="toc-architectural-choices-involved-in-llm-based-agent-design" class="nav-link" data-scroll-target="#architectural-choices-involved-in-llm-based-agent-design">Architectural choices involved in LLM Based Agent design</a></li>
  <li><a href="#in-context-methods" id="toc-in-context-methods" class="nav-link" data-scroll-target="#in-context-methods">In-Context Methods</a>
  <ul class="collapse">
  <li><a href="#our-approach" id="toc-our-approach" class="nav-link" data-scroll-target="#our-approach">Our-Approach</a></li>
  </ul></li>
  <li><a href="#in-weight-methods" id="toc-in-weight-methods" class="nav-link" data-scroll-target="#in-weight-methods">In-Weight Methods</a>
  <ul class="collapse">
  <li><a href="#our-approach-1" id="toc-our-approach-1" class="nav-link" data-scroll-target="#our-approach-1">Our-Approach</a></li>
  </ul></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  <li><a href="#tic-tac-toe-propmt-based-agents" id="toc-tic-tac-toe-propmt-based-agents" class="nav-link" data-scroll-target="#tic-tac-toe-propmt-based-agents">Tic-Tac-Toe, Propmt-based Agents</a></li>
  <li><a href="#tic-tac-toe-chain-of-though-prompt-based-agents" id="toc-tic-tac-toe-chain-of-though-prompt-based-agents" class="nav-link" data-scroll-target="#tic-tac-toe-chain-of-though-prompt-based-agents">Tic-Tac-Toe, Chain-of-Though Prompt based Agents</a>
  <ul class="collapse">
  <li><a href="#llama2_7b" id="toc-llama2_7b" class="nav-link" data-scroll-target="#llama2_7b">llama2_7b</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">LLMs playing games</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Random</div>
    <div class="quarto-category">Visualization</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><strong>Can LLMs plan and reason?</strong></p>
<div class="callout-note callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This page is alive i.e, I‚Äôll be adding new visualizations (new <code>LLM</code>, <code>Game</code>, <code>Planning approach</code> etc.).</p>
</div>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In-context learning and instruction following capabilities of LLMs combined with their large world knowledge made them great a solving system 1<span class="citation" data-cites="kahneman2011thinking">(<a href="#ref-kahneman2011thinking" role="doc-biblioref">Kahneman 2011</a>)</span> tasks. The next obvious question would be to evaluate their performance in tasks that require deliberate thinking and planning i.e.&nbsp;system 2<span class="citation" data-cites="kahneman2011thinking">(<a href="#ref-kahneman2011thinking" role="doc-biblioref">Kahneman 2011</a>)</span> tasks.</p>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<p>Recent works try to evaluate system 2 capabilites of LLMs through</p>
<ol type="1">
<li>Planning to solve tasks in interactive text-world environments
<ol type="1">
<li>ALFWorld <span class="citation" data-cites="shridhar2020alfworld">(<a href="#ref-shridhar2020alfworld" role="doc-biblioref">Shridhar et al. 2020</a>)</span>.</li>
<li>Web-Shop <span class="citation" data-cites="yao2022webshop">(<a href="#ref-yao2022webshop" role="doc-biblioref">Yao et al. 2022</a>)</span>.</li>
</ol></li>
<li>Fact Checking tasks
<ol type="1">
<li>FEVER <span class="citation" data-cites="thorne2018fever">(<a href="#ref-thorne2018fever" role="doc-biblioref">Thorne et al. 2018</a>)</span></li>
</ol></li>
<li>Question Answering tasks
<ol type="1">
<li>HotPotQA <span class="citation" data-cites="yang2018hotpotqa">(<a href="#ref-yang2018hotpotqa" role="doc-biblioref">Yang et al. 2018</a>)</span></li>
</ol></li>
</ol>
<p>The issue with these evaluations is that an LLM with prior knowledge of facts can easily solve the tasks without deliberate thinking and planning.</p>
<p>In their new work <span class="citation" data-cites="duan2024gtbench">(<a href="#ref-duan2024gtbench" role="doc-biblioref">Duan et al. 2024</a>)</span> Propose to evaluate deliberate thinking through game-theoretic tasks.</p>
<blockquote class="blockquote">
<p>‚Äúthe extensive background and intricate details involved in role-play-based games dilute the pureness of logic and strategic reasoning that is typically found in game theoretic tasks‚Äù</p>
</blockquote>
<p>They Propose GTBench a collection of 11 games and suggest evaluating LLM capabilities through LLM vs LLM or LLM vs Classical Agent games.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="agents/gtbench_games.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">11 Games part of GTBench <span class="citation" data-cites="duan2024gtbench">(<a href="#ref-duan2024gtbench" role="doc-biblioref">Duan et al. 2024</a>)</span></figcaption><p></p>
</figure>
</div>
<p>We use GTBench to evaluate the Planning capabilities of LLMs.</p>
</section>
<section id="architectural-choices-involved-in-llm-based-agent-design" class="level2">
<h2 class="anchored" data-anchor-id="architectural-choices-involved-in-llm-based-agent-design">Architectural choices involved in LLM Based Agent design</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="agents/llm_arch.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">As Surveyed by <span class="citation" data-cites="huang2024understanding">(<a href="#ref-huang2024understanding" role="doc-biblioref">Huang et al. 2024</a>)</span></figcaption><p></p>
</figure>
</div>
</section>
<section id="in-context-methods" class="level2">
<h2 class="anchored" data-anchor-id="in-context-methods">In-Context Methods</h2>
<section id="our-approach" class="level3">
<h3 class="anchored" data-anchor-id="our-approach">Our-Approach</h3>
<section id="results" class="level4">
<h4 class="anchored" data-anchor-id="results">Results</h4>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>NRA</th>
<th>Prompt-GPT4 Agent</th>
<th>CoT-GPT4 Agent</th>
<th>ToT-GPT4 Agent</th>
<th>IC-MCTS Agent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>VS MCTS</td>
<td>-0.66</td>
<td>-0.3</td>
<td>-0.5</td>
<td>-0.75</td>
</tr>
<tr class="even">
<td>VS Rand-Agent</td>
<td>0.5</td>
<td>0.5454</td>
<td>0.25</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="in-weight-methods" class="level2">
<h2 class="anchored" data-anchor-id="in-weight-methods">In-Weight Methods</h2>
<section id="our-approach-1" class="level3">
<h3 class="anchored" data-anchor-id="our-approach-1">Our-Approach</h3>
<section id="rlhf-finetuning-for-strategic-reasoning" class="level4">
<h4 class="anchored" data-anchor-id="rlhf-finetuning-for-strategic-reasoning">RLHF finetuning for strategic reasoning</h4>
<p>A traditional RLHF pipeline has the following steps</p>
<ul>
<li>Gather preference data</li>
<li>Train a reward model</li>
<li>Use feedback from the reward model to train the LLM using PPO</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="agents/RLHF.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">A standard RLHF pipeline</figcaption><p></p>
</figure>
</div>
<p>We adapt this pipeline for training LLM agents to play strategic games. Instead of gathering preference data and then training a reward model, we directly train a Deep Q Network model using self play. This Deep Q Network model will then be used to provide reward values for responses from the LLM.</p>
<p>The whole pipeline is as shown below:</p>
<ul>
<li>Train DQN using self-play to play games from the Open Spiel framework</li>
<li>Evaluate the DQN against random agent and another DQN agent and store it in state buffer</li>
<li>Generate rewards for state, action pairs in the replay buffer</li>
<li>Generate prompts for each state, prompt LLM to get it‚Äôs response. Extract action using regex</li>
<li>Use reward from the DQN as feedback, train the LLM using PPO</li>
</ul>
<p>The above steps can be repeated for multiple games and a multi-game dataset of state/action pairs along with their rewards can be created. In particular we generate a five game dataset which includes data from the games Tic-Tac-Toe, Kuhn‚Äôs Poker, Nim, Liar‚Äôs dice, and Pig. The reason we restrict ourselves to these games is that they have an easy structure which makes it relatively simpler to engineer prompts and regexes for them.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="agents/DQN-RLHF.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">DQN RLHF pipeline for strategic reasoning over games</figcaption><p></p>
</figure>
</div>
</section>
<section id="results-1" class="level4">
<h4 class="anchored" data-anchor-id="results-1">Results</h4>
<table class="table">
<colgroup>
<col style="width: 31%">
<col style="width: 37%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Normalized Relative Advantage</th>
<th>RLHF LLAMA2 (only ticatac toe data)</th>
<th>RLHF LLAMA2 (Multi-Game Data)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>VS LLAMA2</td>
<td>0.18</td>
<td>0.16</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<p>Here are some visualizations of LLMs playing against classical AI agents.</p>
<ul>
<li>7B parameter LLMs are not great at the tasks as can be seen from the visualizations.</li>
<li>I‚Äôll soon upload the visualizations for larger LLMs.</li>
</ul>
</section>
<section id="tic-tac-toe-propmt-based-agents" class="level2">
<h2 class="anchored" data-anchor-id="tic-tac-toe-propmt-based-agents">Tic-Tac-Toe, Propmt-based Agents</h2>
<ul>
<li>Game: Tic-Tac-Toe</li>
<li>LLMs: LLAMA2 7B, MISTRAL 7B</li>
<li>Agent Design: Propmt based, i.e, game instructions and current state are given in the input prompt to the LLM.</li>
<li>Reasoning Module: None/LLM itself.</li>
</ul>
<p>The Player using üü• Is the LLM Agent</p>
<p>The Player using üü¶ Is Monte Carlo Tree Search.</p>
<div id="fig-elephants" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/llama2_7b/00000_fix.gif" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/llama2_7b/00001_fix.gif" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/llama2_7b/00002_fix.gif" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: LLAMA2 7B</figcaption><p></p>
</figure>
</div>
<div id="fig-elephants2" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/mistral_7b/00000_fix.gif" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/mistral_7b/00001_fix.gif" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="assets/llm_agents/mistral_7b/00002_fix.gif" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: MISTRAL 7B</figcaption><p></p>
</figure>
</div>
</section>
<section id="tic-tac-toe-chain-of-though-prompt-based-agents" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="tic-tac-toe-chain-of-though-prompt-based-agents">Tic-Tac-Toe, Chain-of-Though Prompt based Agents</h2>
<section id="llama2_7b" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="llama2_7b">llama2_7b</h3>
<ol type="1">
<li>Topmost paragraph is the system prompt.</li>
<li>Second paragraph is the user prompt.</li>
<li>LLM response is the last paragraph.</li>
</ol>
<div class="column-page">
<p><video src="assets/llm_agents/cot_agents/llama2.mp4" class="img-fluid" controls=""><a href="assets/llm_agents/cot_agents/llama2.mp4">Video</a></video></p>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-duan2024gtbench" class="csl-entry" role="doc-biblioentry">
Duan, Jinhao, Renming Zhang, James Diffenderfer, Bhavya Kailkhura, Lichao Sun, Elias Stengel-Eskin, Mohit Bansal, Tianlong Chen, and Kaidi Xu. 2024. <span>‚ÄúGtbench: Uncovering the Strategic Reasoning Limitations of Llms via Game-Theoretic Evaluations.‚Äù</span> <em>arXiv Preprint arXiv:2402.12348</em>.
</div>
<div id="ref-huang2024understanding" class="csl-entry" role="doc-biblioentry">
Huang, Xu, Weiwen Liu, Xiaolong Chen, Xingmei Wang, Hao Wang, Defu Lian, Yasheng Wang, Ruiming Tang, and Enhong Chen. 2024. <span>‚ÄúUnderstanding the Planning of LLM Agents: A Survey.‚Äù</span> <em>arXiv Preprint arXiv:2402.02716</em>.
</div>
<div id="ref-kahneman2011thinking" class="csl-entry" role="doc-biblioentry">
Kahneman, Daniel. 2011. <em>Thinking, Fast and Slow</em>. macmillan.
</div>
<div id="ref-shridhar2020alfworld" class="csl-entry" role="doc-biblioentry">
Shridhar, Mohit, Xingdi Yuan, Marc-Alexandre C√¥t√©, Yonatan Bisk, Adam Trischler, and Matthew Hausknecht. 2020. <span>‚ÄúAlfworld: Aligning Text and Embodied Environments for Interactive Learning.‚Äù</span> <em>arXiv Preprint arXiv:2010.03768</em>.
</div>
<div id="ref-thorne2018fever" class="csl-entry" role="doc-biblioentry">
Thorne, James, Andreas Vlachos, Christos Christodoulopoulos, and Arpit Mittal. 2018. <span>‚ÄúFEVER: A Large-Scale Dataset for Fact Extraction and VERification.‚Äù</span> <em>arXiv Preprint arXiv:1803.05355</em>.
</div>
<div id="ref-yang2018hotpotqa" class="csl-entry" role="doc-biblioentry">
Yang, Zhilin, Peng Qi, Saizheng Zhang, Yoshua Bengio, William W Cohen, Ruslan Salakhutdinov, and Christopher D Manning. 2018. <span>‚ÄúHotpotQA: A Dataset for Diverse, Explainable Multi-Hop Question Answering.‚Äù</span> <em>arXiv Preprint arXiv:1809.09600</em>.
</div>
<div id="ref-yao2022webshop" class="csl-entry" role="doc-biblioentry">
Yao, Shunyu, Howard Chen, John Yang, and Karthik Narasimhan. 2022. <span>‚ÄúWebshop: Towards Scalable Real-World Web Interaction with Grounded Language Agents.‚Äù</span> <em>Advances in Neural Information Processing Systems</em> 35: 20744‚Äì57.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>